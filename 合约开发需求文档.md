ğŸ§  é¡¹ç›®åç§°ï¼šTokenPresale with Linear Vestingï¼ˆçº¿æ€§è§£é”çš„ä»£å¸é¢„å”®åˆçº¦ï¼‰

ğŸª™ èƒŒæ™¯è¯´æ˜ï¼š

æŸ DeFi é¡¹ç›®æ‰“ç®—ä¸Šçº¿æ–°å¸ï¼ˆTokenï¼‰ï¼Œä¸ºå¸å¼•æ—©æœŸç”¨æˆ·å¹¶ç­¹é›†å¯åŠ¨èµ„é‡‘ï¼Œå†³å®šå‘èµ·ä¸€åœº ETH é¢„å”®ï¼š
	â€¢	é¡¹ç›®æ–¹è®¾å®šæ€»å‹Ÿèµ„ç›®æ ‡ï¼ˆä»¥ USD ä¸ºå•ä½ï¼‰ï¼Œä¾‹å¦‚ $5000ã€‚
	â€¢	ç”¨æˆ·é€šè¿‡ ETH æèµ ï¼ˆè‡ªåŠ¨æ¢ç®—æˆ USDï¼‰ã€‚
	â€¢	TGEï¼ˆä»£å¸ç”Ÿæˆäº‹ä»¶ï¼‰åï¼Œç”¨æˆ·å¼€å§‹æŒ‰çº¿æ€§æ–¹å¼è§£é”é¢†å–ä»£å¸ã€‚
	â€¢	ä»£å¸çº¿æ€§è§£é”å‘¨æœŸä¸º 180 å¤©ã€‚

â¸»

ğŸ— åˆçº¦ç»“æ„ä¸æ ¸å¿ƒåŠŸèƒ½è®¾è®¡ï¼š

1ï¸âƒ£ çŠ¶æ€å˜é‡ï¼š

å˜é‡å	ç±»å‹	å«ä¹‰
address public immutable owner;	address	é¡¹ç›®æ–¹åœ°å€
AggregatorV3Interface public priceFeed;	æ¥å£å®ä¾‹	Chainlink ä»·æ ¼é¢„è¨€æœº
uint256 public immutable presaleEndTime;	uint256	é¢„å”®ç»“æŸæ—¶é—´æˆ³
uint256 public immutable goalInUsd;	uint256	å‹Ÿé›†ç›®æ ‡ï¼Œå•ä½ USDï¼ˆä¹˜ä»¥ 1e18ï¼‰
uint256 public totalUsdRaised;	uint256	å½“å‰å·²å‹Ÿèµ„æ€»é¢
bool public isClaimEnabled;	bool	æ˜¯å¦å…è®¸ç”¨æˆ·é¢†å– Token
uint256 public immutable tokenPerUsdRate;	uint256	ä»£å¸å…‘æ¢æ¯”ä¾‹ï¼Œä¾‹å¦‚ 100 = 1 USD å¾— 100 Token
uint256 public immutable unlockStartTime;	uint256	çº¿æ€§è§£é”èµ·å§‹æ—¶é—´
uint256 public constant unlockDuration = 180 days;	å¸¸é‡	è§£é”æ€»æ—¶é•¿
mapping(address => uint256) public userUsdContributed;	mapping	ç”¨æˆ·æèµ çš„ USD é‡‘é¢
mapping(address => uint256) public userClaimedTokens;	mapping	ç”¨æˆ·å·²é¢†å–çš„ä»£å¸æ•°é‡
address[] public contributors;	address[]	æ‰€æœ‰å‚ä¸ç”¨æˆ·åˆ—è¡¨ï¼ˆè¾…åŠ©éå†ï¼‰


â¸»

2ï¸âƒ£ å‡½æ•°åŠŸèƒ½éœ€æ±‚ï¼š

å‡½æ•°å	ä¿®é¥°ç¬¦	åŠŸèƒ½
fund()	payable	æèµ  ETHï¼Œå†…éƒ¨æ¢ç®—ä¸º USDï¼Œæ ¡éªŒæ—¶é—´ä¸ç›®æ ‡ï¼Œæ›´æ–°æ˜ å°„
enableClaim()	onlyOwner, presaleEnded	å¼€å¯ç”¨æˆ·é¢†å– Token æƒé™ï¼Œæ ‡è®° TGE å®Œæˆ
claimTokens()	æ— 	ç”¨æˆ·è°ƒç”¨ï¼ŒæŒ‰æ—¶é—´çº¿æ€§é¢†å–å°šæœªé¢†å–çš„ Token
withdrawETH()	onlyOwner, presaleEnded	é¡¹ç›®æ–¹æç° ETHï¼ˆcallæ–¹å¼ï¼‰
getTokenClaimable(address user)	view	æŸ¥è¯¢æŸåœ°å€å¯é¢†å–çš„ Token æ•°é‡
getUserInfo(address user)	view	Bonus: è¿”å›æ€»æã€å·²é¢†ã€å¯é¢† Token
receive()	external payable	ç›´æ¥è½¬è´¦è§¦å‘å‚ä¸ fund()
fallback()	external payable	æ¥æ”¶éæ³• calldata ä½†å« ETH çš„è½¬è´¦


â¸»

3ï¸âƒ£ å¿…é¡»å®ç°çš„ modifierï¼š

åç§°	é€»è¾‘è¯´æ˜
onlyOwner	require(msg.sender == owner)
presaleEnded	require(block.timestamp >= presaleEndTime)
claimEnabled	require(isClaimEnabled)
notEnded	require(block.timestamp < presaleEndTime)


â¸»

4ï¸âƒ£ çº¿æ€§è§£é”è®¡ç®—é€»è¾‘ï¼š

function getTokenClaimable(address user) public view returns (uint256) {
    if (!isClaimEnabled) return 0;

    uint256 totalTokens = userUsdContributed[user] * tokenPerUsdRate;
    uint256 elapsed = block.timestamp - unlockStartTime;
    if (elapsed >= unlockDuration) {
        return totalTokens - userClaimedTokens[user];
    }
    uint256 unlocked = (totalTokens * elapsed) / unlockDuration;
    return unlocked - userClaimedTokens[user];
}


â¸»

5ï¸âƒ£ Chainlink æ±‡ç‡æ¢ç®—é€»è¾‘ï¼š

å‚è€ƒ library å†™æ³•ï¼š

function getEthToUsd(uint256 ethAmount) internal view returns (uint256) {
    (, int256 answer,,,) = priceFeed.latestRoundData(); // 8 decimals
    uint256 ethPrice = uint256(answer) * 1e10; // æ‰©ç²¾åº¦åˆ° 1e18
    return (ethAmount * ethPrice) / 1e18;
}


â¸»

6ï¸âƒ£ å‡½æ•°å®ç°è¦ç‚¹ï¼š

fund():
	â€¢	msg.value è½¬æ¢ä¸º USDã€‚
	â€¢	æèµ å€¼ â‰¥ $10ï¼Œå¤±è´¥ revertã€‚
	â€¢	ä¸èƒ½è¶…è¿‡ goalInUsdã€‚
	â€¢	æ›´æ–° mapping å’Œ totalUsdRaisedã€‚
	â€¢	æ–°åœ°å€åŠ å…¥ contributorsã€‚

enableClaim():
	â€¢	ä»… ownerã€‚
	â€¢	è®¾ç½® isClaimEnabled = trueã€‚
	â€¢	unlockStartTime = block.timestamp;

claimTokens():
	â€¢	è®¡ç®—ç”¨æˆ·å¯é¢†å–çš„ Token æ•°é‡ã€‚
	â€¢	æ›´æ–° userClaimedTokensã€‚
	â€¢	å‘æ”¾ä»£å¸ï¼ˆå¯é€‰ï¼šè°ƒç”¨ token åˆçº¦ï¼‰ã€‚

withdrawETH():
	â€¢	ä»… ownerã€‚
	â€¢	é¢„å”®å·²ç»“æŸã€‚
	â€¢	é€šè¿‡ call å‘é€ ETH è‡³ ownerã€‚

â¸»

ğŸ” å®‰å…¨æ§åˆ¶ï¼š
	â€¢	é˜²æ­¢é‡å¤é¢†å–ï¼šuserClaimedTokens è®°å½•ã€‚
	â€¢	ä½¿ç”¨è‡ªå®šä¹‰ error + revert èŠ‚çœ gasã€‚
	â€¢	call æç°ä½¿ç”¨ require(success)ã€‚
	â€¢	æ¥æ”¶ ETH æ—¶ï¼Œä¿è¯è§¦å‘ fund()ï¼Œé¿å…ç»•è¿‡é€»è¾‘ã€‚

â¸»

ğŸ”§ Bonus æŒ‘æˆ˜åŠŸèƒ½ï¼š

åŠŸèƒ½	æè¿°
getUserInfo(address)	è¿”å›ç”¨æˆ·è´¡çŒ® USDã€å·²é¢†å– Tokenã€å¯é¢†å– Token
pause() / unpause()	é¡¹ç›®æ–¹å¯æš‚åœåˆçº¦æ‰§è¡Œï¼ˆæ­é… modifierï¼‰
setRate()	æ›´æ”¹å…‘æ¢æ¯”ä¾‹ï¼Œå¿…é¡»åŠ æƒé™æ§åˆ¶ï¼ˆå¦‚ onlyOwner ä¸”æœªå¼€å§‹ï¼‰


â¸»

ğŸ§  æ€è€ƒé¢˜æç¤ºï¼š
	1.	å¦‚ä½•é˜²æ­¢é‡å…¥æ”»å‡»ï¼Ÿ
	2.	å¦‚ä½•ç»Ÿä¸€ç²¾åº¦ï¼ˆETH 1e18ï¼ŒUSD 1e18ï¼‰ï¼Ÿ
	3.	å¦‚ä½•å†™ gas-efficient çš„ claimTokens()ï¼Ÿ
	4.	å¦‚æœé›†æˆ token åˆçº¦ï¼Œéœ€è¦ IERC20 å…¼å®¹æ€§å’Œæˆæƒï¼Ÿ

â¸»

å¦‚ä½ æ‰“ç®—ä»…åœ¨ Remix ä¸­å¼€å‘ï¼Œåªéœ€åˆ›å»ºä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š

ğŸ“ é¡¹ç›®ç»“æ„ï¼š

contracts/
â”œâ”€â”€ TokenPresale.sol         // ä¸»åˆçº¦
â”œâ”€â”€ PriceConverter.sol       // Chainlink æ±‡ç‡åº“ï¼ˆlibraryï¼‰
interfaces/
â”œâ”€â”€ AggregatorV3Interface.sol // Chainlink æ¥å£